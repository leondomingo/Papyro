<?xml version="1.0" encoding="ISO-8859-1" ?>
<report>
    <name>Otro informe con GroupHeader</name>
    <configuration>
        <paper>
            <size>A4</size>            
            <margin>
                <left>15</left>
                <right>15</right>
                <top>15</top>
                <bottom>15</bottom>
            </margin>
            <orientation>portrait</orientation>
        </paper>
        <switch_between_pages/>
    </configuration>
    <font>
        <name>Helvetica</name>
        <size>10</size>
        <color>000000</color>
        <style>
        </style>
    </font>
    <params>
        <param name="P_NUMERO_GRUPOS" type="int">50</param>
        <param name="P_GRUPO" type="int"></param>
    </params>
    <report_title>
        <id>title_1</id>
        <body></body>
    </report_title>
    <script>
        <file>report1.py</file>
    </script>
    <page>
        <id>page_1</id>
        <number>1</number>
        <page_header>
            <id>page_header_1</id>
            <size>
                <height>25</height>
                <width></width>
            </size>
            <options>
                <print_on_first_page/>
            </options>
            <body>
                <image>
                    <id></id>
                    <print_if>#PAGE_NO# % 2 != 0</print_if>
                    <filename>img1.jpg</filename>
                    <keep_aspect_ratio/>
                    <position>
                        <left>120</left>
                        <top>0</top>
                    </position>
                    <size>
                        <height>30</height>
                        <width>70</width>
                    </size>
                </image>
                <text>
                    <id></id>
                    <value>PAGE HEADER</value>
                    <position>
                        <left>5</left>
                        <top>2</top>
                    </position>
                    <size>
                        <height>4</height>
                        <width>0</width>
                    </size>
                    <font>
                        <name>CourierNew</name>
                        <size>20</size>
                        <color></color>
                        <style></style>
                    </font>
                </text>
                <text>
                    <id></id>
                    <value>Hola, mundo! (pág: #PAGE_NO# Fecha: #DATE# Hora: #TIME#)</value>
                    <position>
                        <left>20</left>
                        <top>7</top>
                    </position>
                    <size>
                        <height>4</height>
                        <width>0</width>
                    </size>
                    <font>
                        <name>TimesNewRoman</name>
                        <size>12</size>
                        <color></color>
                        <style></style>
                    </font>
                </text>
            </body>
        </page_header>        
        <page_footer>
            <id>page_footer_1</id>
            <size>
                <height>25</height>
                <width></width>
            </size>
            <options>
                <print_on_first_page/>
            </options>
            <body>
                <text>
                    <id></id>
                    <value>PAGE FOOTER</value>
                    <position>
                        <left>5</left>
                        <top>5</top>
                    </position>
                    <size>
                        <height>4</height>
                        <width>0</width>
                    </size>
                    <font>
                        <name>Georgia</name>
                        <size>20</size>
                        <color></color>
                        <style></style>
                    </font>
                </text>                
                <text>
                    <id></id>
                    <print_if>#PAGE_NO# % 2 != 0</print_if>
                    <value>pág: #PAGE_NO# Esta es una página IMPAR</value>
                    <position>
                        <left>15</left>
                        <top>10</top>
                    </position>
                    <size>
                        <height>4</height>
                        <width>0</width>
                    </size>
                    <font>
                        <name>Verdana</name>
                        <size>9</size>
                        <color></color>
                        <style></style>
                    </font>
                </text>
                <text>
                    <id></id>
                    <print_if>#PAGE_NO# % 2 == 0</print_if>
                    <value>pág: #PAGE_NO# Esta es una página PAR</value>
                    <position>
                        <left>15</left>
                        <top>10</top>
                    </position>
                    <size>
                        <height>4</height>
                        <width>0</width>
                    </size>
                    <font>
                        <name>Verdana</name>
                        <size>9</size>
                        <color></color>
                        <style></style>
                    </font>
                </text>
            </body>
        </page_footer>
        <body>
            <master>
                <id>master_1</id>
                <table>
                    <fields>
                        <field>CURSOS_ID</field>
                        <field>CURSOS_NOMBRE</field>
                        <field>GRUPOS_ID</field>
                        <field>GRUPOS_NOMBRE</field>
                    </fields>
                    <query>
                    SELECT
                        cursos.id as "CURSOS_ID",
                        cursos.nombre as "CURSOS_NOMBRE",
                        grupos.id as "GRUPOS_ID",
                        grupos.nombre as "GRUPOS_NOMBRE",
                        coalesce(clientes.nombre, '') as "CLIENTES_NOMBRE",
                        format_fecha('dd/mm/yyyy', grupos.fechainicio) as "GRUPOS_FECHAINICIO",
                        format_fecha('dd/mm/yyyy', grupos.fechafin) as "GRUPOS_FECHAFIN"
                    FROM grupos
                    JOIN cursos on cursos.id = grupos.id_cursos_cursodelgrupo
                    LEFT JOIN clientes on clientes.id = cursos.id_clientes_propietario
                    WHERE 
                        grupos.fechainicio is not null AND
                        grupos.fechafin is not null
                        -- AND grupos.id = %(P_GRUPO)s
                    ORDER BY cursos.nombre
                    --LIMIT %(P_NUMERO_GRUPOS)s
                    </query>
                </table>
                <group_header>
                    <id>gh_cursos</id>
                    <field>CURSOS_NOMBRE</field>
                    <footer_id>gf_cursos</footer_id>
                    <options>
                        <__print_on_new_page/>
                    </options>
                    <header>
                        <code>code.sum_valor('cursos', 1)</code>
                        <code>code.set_valor('grupos', 0)</code>
                        <text>
                            <id>111</id>
                            <value>{{code.get_valor('cursos')}}  {{"#CURSOS_NOMBRE#".strip()}} (#CLIENTES_NOMBRE#)</value>
                            <position>
                                <left>5</left>
                                <top>2</top>
                            </position>
                            <size>
                                <height>6</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name></name>
                                <size>9</size>
                                <color></color>
                                <style></style>
                            </font>
                        </text>                       
                    </header>
                </group_header>
                <group_header>
                    <id>gh_grupos</id>
                    <field>GRUPOS_NOMBRE</field>
                    <options></options>
                    <footer_id>gf_grupos</footer_id>
                    <header>
                        <!--<split_on_new_page/>-->
                        <code>code.sum_valor('grupos', 1); code.set_valor('alumnos', 0)</code>
                        <text>
                            <id></id>
                            <value>El cuadrado de {{code.get_valor('cursos')}} es {{code.get_valor('cursos') ** 2}}____{{code.get_valor('cursos')}}.{{code.get_valor('grupos')}} #GRUPOS_NOMBRE#</value>
                            <position>
                                <left>15</left>
                                <top>2</top>
                            </position>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name>Arial</name>
                                <size>7</size>
                                <color></color>
                                <style></style>
                            </font>
                        </text>
                        <text>
                            <id></id>
                            <value>{{'1º, 2º ó 3º' if code.get_valor('grupos') in [1, 2, 3] else '4º en adelante'}}  #GRUPOS_FECHAINICIO# - #GRUPOS_FECHAFIN#</value>
                            <position>
                                <left>15</left>
                                <top>5</top>
                            </position>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name>MsSanSerif</name>
                                <size>5</size>
                                <color></color>
                                <style></style>
                            </font>
                        </text>
                    </header>
                </group_header>
                <group_footer>
                    <id>gf_grupos</id>
                    <body>
                        <print_if>code.get_valor('alumnos') > 0</print_if>
                        <text>
                            <id></id>
                            <value>Nº de alumnos = {{code.get_valor('alumnos')}} </value>
                            <position>
                                <left>18</left>
                                <top>5</top>
                            </position>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name>VeraSans</name>
                                <size>5</size>
                                <color></color>
                                <style></style>
                            </font>                            
                        </text>
                    </body>
                </group_footer>
                <group_footer>
                    <id>gf_cursos</id>
                    <body>
                        <text>
                            <id></id>
                            <value>Nº de grupos = {{code.get_valor('grupos')}}</value>
                            <position>
                                <left>8</left>
                                <top>5</top>
                            </position>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name>Arial</name>
                                <size>6</size>
                                <color></color>
                                <style></style>
                            </font>                            
                        </text>
                    </body>
                </group_footer>                
                <body>
                    <line>
                        <id>linea_1</id>
                        <x1>20</x1>
                        <y1>3</y1>
                        <x2>150</x2>
                        <y2>3</y2>
                    </line>
                </body>
                <detail>
                    <id>detail_1</id>
                    <master_field>GRUPOS_ID</master_field>
                    <table>
                        <query>
                            SELECT
                                alias_alumno(alumnos.id) as "ALUMNOS_ALIAS",
                                format_fecha('dd/mm/yyyy', aeg.fecha_inicio) as "AEG_FECHAINICIO",
                                format_fecha('dd/mm/yyyy', aeg.fecha_fin) as "AEG_FECHAFIN"
                            FROM alumnos
                            JOIN alumnos_en_grupos aeg on 
                                alumnos.id = aeg.id_alumnos_alumno and
                                aeg.id_grupos_grupo = %(GRUPOS_ID)d
                            ORDER BY aeg.fecha_inicio
                        </query>
                        <fields>
                            <field>MATRICULAS_FECHAINICIO</field>
                            <field>CURSOS_NOMBRE</field>
                        </fields>
                    </table>
                    <header>
                        <id></id>
                        <body>
                            <text>
                                <id></id>
                                <value>Alumnos del grupo</value>
                                <position>
                                    <left>20</left>
                                    <top>0</top>
                                </position>
                                <size>
                                    <height>3</height>
                                    <width>0</width>
                                </size>
                                <font>
                                    <name>VeraSans</name>
                                    <size>5</size>
                                    <color>D000FF</color>
                                    <style></style>
                                </font>
                            </text>
                        </body>
                    </header>
                    <body>
                        <code>code.sum_valor('alumnos', 1)</code>
                        <text>
                            <id>txt_alumno</id>
                            <value>{{code.get_valor('alumnos')}}. #ALUMNOS_ALIAS#</value>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <position>
                                <left>20</left>
                                <top>0</top>
                            </position>
                            <font>
                                <name>Tahoma</name>
                                <size>7</size>
                                <color></color>
                                <style></style>
                            </font>                            
                        </text>
                        <text>
                            <id>txt_alumno</id>
                            <value>(desde #AEG_FECHAINICIO# hasta #AEG_FECHAFIN#)</value>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <position>
                                <left>80</left>
                                <top>0</top>
                            </position>
                            <font>
                                <name>LucidaSans</name>
                                <size>4</size>
                                <color></color>
                                <style></style>
                            </font>                            
                        </text>
                    </body>
                </detail>                
            </master>
        </body>
    </page>
</report>
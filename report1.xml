<?xml version="1.0" encoding="ISO-8859-1" ?>
<report>
    <name>Otro informe con GroupHeader</name>
    <configuration>
        <paper>
            <size>A4</size>
            <margin>
                <left>15</left>
                <right>15</right>
                <top>15</top>
                <bottom>15</bottom>
            </margin>
            <orientation>portrait</orientation>
        </paper>
    </configuration>
    <font>
        <name>Helvetica</name>
        <size>10</size>
        <color>000000</color>
        <style>
        </style>
    </font>
    <params>
        <param name="NUMERO_GRUPOS" type="int">50</param>
    </params>
    <report_title>
        <id>title_1</id>
        <body></body>
    </report_title>
    <page>
        <id>page_1</id>
        <number>1</number>
        <body>
            <master>
                <id>master_1</id>
                <table>
                    <fields>
                        <field>CURSOS_ID</field>
                        <field>CURSOS_NOMBRE</field>
                        <field>GRUPOS_ID</field>
                        <field>GRUPOS_NOMBRE</field>
                    </fields>
                    <query>
                    SELECT
                        cursos.id as "CURSOS_ID",
                        cursos.nombre as "CURSOS_NOMBRE",
                        grupos.id as "GRUPOS_ID",
                        grupos.nombre as "GRUPOS_NOMBRE",
                        coalesce(clientes.nombre, '') as "CLIENTES_NOMBRE",
                        format_fecha('dd/mm/yyyy', grupos.fechainicio) as "GRUPOS_FECHAINICIO",
                        format_fecha('dd/mm/yyyy', grupos.fechafin) as "GRUPOS_FECHAFIN"
                    FROM grupos
                    JOIN cursos on cursos.id = grupos.id_cursos_cursodelgrupo
                    LEFT JOIN clientes on clientes.id = cursos.id_clientes_propietario
                    WHERE 
                        grupos.fechainicio is not null AND
                        grupos.fechafin is not null                        
                    ORDER BY cursos.nombre
                    --LIMIT %(NUMERO_GRUPOS)s
                    </query>
                </table>
                <group_header>
                    <id>gh_cursos</id>
                    <field>CURSOS_NOMBRE</field>
                    <options>
                        <!--<print_on_new_page/>-->
                    </options>
                    <header>
                        <text>
                            <id>111</id>
                            <value>#CURSOS_NOMBRE# (#CLIENTES_NOMBRE#)</value>
                            <position>
                                <left>5</left>
                                <top>2</top>
                            </position>
                            <size>
                                <height>6</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name></name>
                                <size>9</size>
                                <color></color>
                                <style></style>
                            </font>
                        </text>                        
                    </header>
                </group_header>
                <group_header>
                    <id>gh_grupos</id>
                    <field>GRUPOS_NOMBRE</field>
                    <options></options>
                    <header>
                        <text>
                            <id>222</id>
                            <value>#GRUPOS_NOMBRE#</value>
                            <position>
                                <left>15</left>
                                <top>2</top>
                            </position>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name></name>
                                <size>7</size>
                                <color></color>
                                <style></style>
                            </font>
                        </text>
                        <text>
                            <id>2232</id>
                            <value>#GRUPOS_FECHAINICIO# - #GRUPOS_FECHAFIN#</value>
                            <position>
                                <left>15</left>
                                <top>5</top>
                            </position>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <font>
                                <name></name>
                                <size>5</size>
                                <color></color>
                                <style></style>
                            </font>
                        </text>
                    </header>
                </group_header>
                <body>
                    <line>
                        <id>linea_1</id>
                        <x1>20</x1>
                        <y1>3</y1>
                        <x2>150</x2>
                        <y2>3</y2>
                    </line>
                </body>
                <detail>
                    <id>detail_1</id>
                    <master_field>GRUPOS_ID</master_field>
                    <table>
                        <query>
                            SELECT
                                alias_alumno(alumnos.id) as "ALUMNOS_ALIAS",
                                format_fecha('dd/mm/yyyy', aeg.fecha_inicio) as "AEG_FECHAINICIO",
                                format_fecha('dd/mm/yyyy', aeg.fecha_fin) as "AEG_FECHAFIN"
                            FROM alumnos
                            JOIN alumnos_en_grupos aeg on 
                                alumnos.id = aeg.id_alumnos_alumno and
                                aeg.id_grupos_grupo = %(GRUPOS_ID)d
                            ORDER BY aeg.fecha_inicio
                        </query>
                        <fields>
                            <field>MATRICULAS_FECHAINICIO</field>
                            <field>CURSOS_NOMBRE</field>
                        </fields>
                    </table>
                    <header>
                        <id></id>
                        <body>
                            <text>
                                <id></id>
                                <value>Alumnos del grupo</value>
                                <position>
                                    <left>20</left>
                                    <top>0</top>
                                </position>
                                <size>
                                    <height>3</height>
                                    <width>0</width>
                                </size>
                                <font>
                                    <name>VeraSans</name>
                                    <size>5</size>
                                    <color>D000FF</color>
                                    <style></style>
                                </font>
                            </text>
                        </body>
                    </header>
                    <body>
                        <text>
                            <id>txt_alumno</id>
                            <value>#ALUMNOS_ALIAS#</value>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <position>
                                <left>20</left>
                                <top>0</top>
                            </position>
                            <font>
                                <name>Tahoma</name>
                                <size>7</size>
                                <color></color>
                                <style></style>
                            </font>                            
                        </text>
                        <text>
                            <id>txt_alumno</id>
                            <value>(desde #AEG_FECHAINICIO# hasta #AEG_FECHAFIN#)</value>
                            <size>
                                <height>3</height>
                                <width>0</width>
                            </size>
                            <position>
                                <left>80</left>
                                <top>0</top>
                            </position>
                            <font>
                                <name>LucidaSans</name>
                                <size>4</size>
                                <color></color>
                                <style></style>
                            </font>                            
                        </text>
                    </body>
                </detail>                
            </master>
        </body>
    </page>
</report>